(function(a,b){if(typeof define==='function'&&define.amd){define(["jquery"],function(c){return(a['Intercooler']=b(c));});}else if(typeof module==='object'&&module.exports){module.exports=b(require("jquery"));}else{a['Intercooler']=b(a["jQuery"]);}}(this,function(a){var b=b||(function(){'use strict';if((typeof Zepto!=="undefined")&&(a==null)){window["$"]=Zepto;}var aW=a('meta[name="intercoolerjs:use-data-prefix"]').attr("content")=="true";var aX=a('meta[name="intercoolerjs:use-actual-http-method"]').attr("content")=="true";var aV=a.map(['ic-get-from','ic-post-to','ic-put-to','ic-patch-to','ic-delete-from','ic-style-src','ic-attr-src','ic-prepend-from','ic-append-from','ic-action'],function(a){return q(a);});var ad=null;var aU=1;var aS=[];var aT=function(c,d){if(!c||!d){return false;}var a=c.split(/[\?#]/,1)[0].split("/").filter(function(a){return a!="";});var b=d.split(/[\?#]/,1)[0].split("/").filter(function(a){return a!="";});if(a==""||b==""){return false;}return b.slice(0,a.length).join("/")==a.join("/")||a.slice(0,b.length).join("/")==b.join("/");};function D(a){a.remove();}function K(a){if(a.closest('.ic-use-transition').length>0){a.data('ic-use-transition',true);a.removeClass('ic-use-transition');}else{a.show();}}function Q(a){if(a.data('ic-use-transition')||a.data('ic-indicator-cleared')){a.data('ic-use-transition',null);a.addClass('ic-use-transition');a.data('ic-indicator-cleared',true);}else{a.hide();}}function q(a){if(aW){return'data-'+a;}else{return a;}}function c(a,b){return a.attr(q(b));}function x(a,c,b){a.attr(q(c),b);}function ar(a,e){try{a.prepend(e);}catch(f){d(a,m(f),"ERROR");}if(c(a,'ic-limit-children')){var b=parseInt(c(a,'ic-limit-children'));if(a.children().length>b){a.children().slice(b,a.children().length).remove();}}}function aR(a,e){try{a.append(e);}catch(f){d(a,m(f),"ERROR");}if(c(a,'ic-limit-children')){var b=parseInt(c(a,'ic-limit-children'));if(a.children().length>b){a.children().slice(0,a.children().length-b).remove();}}}function h(c,b,d){if(a.zepto){b=b.split(".").reverse().join(":");}c.trigger(b,d);}function d(b,c,f){if(b==null){b=a('body');}h(b,"log.ic",[c,f,b]);if(f=="ERROR"){if(window.console){window.console.log("Intercooler Error : "+c);}var g=e(a('body'),'ic-post-errors-to');if(g){a.post(g,{'error':c});}}}function w(){return aU++;}function aD(a){return g("ic-id='"+X(a)+"'");}function j(a){d(null,"POLL: Parsing interval string "+a,'DEBUG');if(a=="null"||a=="false"||a==""){return null;}else if(a.lastIndexOf("ms")==a.length-2){return parseFloat(a.substr(0,a.length-2));}else if(a.lastIndexOf("s")==a.length-1){return parseFloat(a.substr(0,a.length-1))*1000;}else{return 1000;}}function g(a){return"["+q(a)+"]";}function aB(){if(ad==null){ad=function(){a(g("ic-trigger-on='scrolled-into-view'")).each(function(){var b=a(this);if(aw(H(b))&&b.data('ic-scrolled-into-view-loaded')!=true){b.data('ic-scrolled-into-view-loaded',true);k(b);}});};a(window).scroll(ad);}}function I(){return window.location.pathname+window.location.search+window.location.hash;}function aa(c){var b=null;if(/<(html|body)/i.test(c)){b=document.documentElement.cloneNode();b.innerHTML=c;}else{b=document.documentElement.cloneNode(true);b.querySelector('body').innerHTML=c;}return a(b);}function p(a){return W(a,'ic-target');}function W(d,f){var e=a(d).closest(g(f));var b=c(e,f);if(b=='this'){return e;}else if(b&&b.indexOf('this.')!=0){if(b.indexOf('closest ')==0){return d.closest(b.substr(8));}else if(b.indexOf('find ')==0){return d.find(b.substr(5));}else{return a(b);}}else{return d;}}function F(c,b){c=a(c);h(c,"beforeHeaders.ic",[c,b]);d(c,"response headers: "+b.getAllResponseHeaders(),"DEBUG");var e=null;if(b.getResponseHeader("X-IC-Title")){document.title=b.getResponseHeader("X-IC-Title");}if(b.getResponseHeader("X-IC-Title-Encoded")){var r=decodeURIComponent((b.getResponseHeader("X-IC-Title-Encoded")).replace(/\+/g,'%20'));document.title=r;}if(b.getResponseHeader("X-IC-Refresh")){var m=b.getResponseHeader("X-IC-Refresh").split(",");d(c,"X-IC-Refresh: refreshing "+m,"DEBUG");a.each(m,function(b,a){E(a.replace(/ /g,""),c);});}if(b.getResponseHeader("X-IC-Script")){d(c,"X-IC-Script: evaling "+b.getResponseHeader("X-IC-Script"),"DEBUG");n(b.getResponseHeader("X-IC-Script"),[["elt",c]]);}if(b.getResponseHeader("X-IC-Redirect")){d(c,"X-IC-Redirect: redirecting to "+b.getResponseHeader("X-IC-Redirect"),"DEBUG");window.location=b.getResponseHeader("X-IC-Redirect");}if(b.getResponseHeader("X-IC-CancelPolling")=="true"){J(c.closest(g('ic-poll')));}if(b.getResponseHeader("X-IC-ResumePolling")=="true"){var i=c.closest(g('ic-poll'));x(i,'ic-pause-polling',null);s(i);}if(b.getResponseHeader("X-IC-SetPollInterval")){var i=c.closest(g('ic-poll'));J(i);x(i,'ic-poll',b.getResponseHeader("X-IC-SetPollInterval"));s(i);}if(b.getResponseHeader("X-IC-Open")){d(c,"X-IC-Open: opening "+b.getResponseHeader("X-IC-Open"),"DEBUG");window.open(b.getResponseHeader("X-IC-Open"));}var f=b.getResponseHeader("X-IC-Trigger");if(f){d(c,"X-IC-Trigger: found trigger "+f,"DEBUG");e=p(c);if(b.getResponseHeader("X-IC-Trigger-Data")){var q=a.parseJSON(b.getResponseHeader("X-IC-Trigger-Data"));h(e,f,q);}else{if(f.indexOf("{")>=0){a.each(a.parseJSON(f),function(a,b){h(e,a,b);});}else{h(e,f,[]);}}}var o=b.getResponseHeader("X-IC-Set-Local-Vars");if(o){a.each(a.parseJSON(o),function(b,a){localStorage.setItem(b,a);});}if(b.getResponseHeader("X-IC-Remove")){if(c){var k=b.getResponseHeader("X-IC-Remove");k+='';var l=j(k);d(c,"X-IC-Remove header found.","DEBUG");e=p(c);if(k=="true"||l==null){D(e);}else{e.addClass('ic-removing');setTimeout(function(){D(e);},l);}}}h(c,"afterHeaders.ic",[c,b]);return true;}function aQ(a){a.addClass('disabled');a.addClass('ic-request-in-flight');a.data('ic-request-in-flight',true);}function C(b,c,a){if(b.length>0){Q(b);}if(c.length>0){Q(c);}a.removeClass('disabled');a.removeClass('ic-request-in-flight');a.data('ic-request-in-flight',false);if(a.data('ic-next-request')){a.data('ic-next-request')["req"]();a.data('ic-next-request',null);}}function L(b,e){if(a.type(b)==="string"){var c=/(&|^)_method=[^&]*/;var d="&_method="+e;if(c.test(b)){return b.replace(c,d);}else{return b+d;}}else{b.append("_method",e);return b;}}function ay(a){return/^[$A-Z_][0-9A-Z_$]*$/i.test(a);}function n(d,b){var e=[];var c=[];if(b){for(var a=0; a<b.length; a++){e.push(b[a][0]);c.push(b[a][1]);}}if(ay(d)){return window[d].apply(this,c);}else{var f=window["eval"].call(window,'(function ('+e.join(", ")+') {'+d+'})');return f.apply(this,c);}}function e(f,d){var b=a(f).closest(g(d));if(b.length>0){return c(b,d);}else{return null;}}function m(b){var a=b.toString()+"\n";try{a+=b.stack;}catch(b){}return a;}function aE(b,j,l,f,p){aQ(b);f=L(f,j);var g=aM(b);if(g&&g.length>0){K(g);}var k=aL(b);if(k.length>0){K(k);}var c=w();var q=new Date();var o;if(aX){o=j;}else{o=j=='GET'?'GET':'POST';}var i={type:o,url:l,data:f,dataType:'text',headers:{"Accept":"text/html-partial, */*; q=0.9","X-IC-Request":true,"X-HTTP-Method-Override":j},beforeSend:function(a,g){h(b,"beforeSend.ic",[b,f,g,a,c]);d(b,"before AJAX request "+c+": "+j+" to "+l,"DEBUG");var i=e(b,'ic-on-beforeSend');if(i){n(i,[["elt",b],["data",f],["settings",g],["xhr",a]]);}t(b,"-beforeSend");},success:function(i,f,a){h(b,"success.ic",[b,i,f,a,c]);d(b,"AJAX request "+c+" was successful.","DEBUG");var j=e(b,'ic-on-success');if(j){if(n(j,[["elt",b],["data",i],["textStatus",f],["xhr",a]])==false){return;}}var s=new Date();var l=document.title;try{if(F(b,a)){d(b,"Processed headers for request "+c+" in "+(new Date()-s)+"ms","DEBUG");var q=new Date();if(a.getResponseHeader("X-IC-PushURL")||e(b,'ic-push-url')=="true"){try{C(k,g,b);var o=a.getResponseHeader("X-IC-PushURL")||e(b,'ic-src');if(r){r.snapshotForHistory(o,l);}else{throw"History support not enabled";}}catch(u){d(b,"Error during history snapshot for "+c+": "+m(u),"ERROR");}}p(i,f,b,a);d(b,"Process content for request "+c+" in "+(new Date()-q)+"ms","DEBUG");}h(b,"after.success.ic",[b,i,f,a,c]);t(b,"-success");}catch(u){d(b,"Error processing successful request "+c+" : "+m(u),"ERROR");}},error:function(a,g,f){h(b,"error.ic",[b,g,f,a]);var i=e(b,'ic-on-error');if(i){n(i,[["elt",b],["status",g],["str",f],["xhr",a]]);}F(b,a);t(b,"-error");d(b,"AJAX request "+c+" to "+l+" experienced an error: "+f,"ERROR");},complete:function(i,j){d(b,"AJAX request "+c+" completed in "+(new Date()-q)+"ms","DEBUG");C(k,g,b);try{if(a.contains(document,b[0])){h(b,"complete.ic",[b,f,j,i,c]);}else{h(a('body'),"complete.ic",[b,f,j,i,c]);}}catch(o){d(b,"Error during complete.ic event for "+c+" : "+m(o),"ERROR");}var l=e(b,'ic-on-complete');if(l){n(l,[["elt",b],["xhr",i],["status",j]]);}t(b,"-complete");}};if(a.type(f)!="string"){i.dataType=null;i.processData=false;i.contentType=false;}h(a(document),"beforeAjaxSend.ic",[i,b]);if(i.cancel){C(k,g,b);}else{a.ajax(i);}}function aM(b){var d=a([]);b=a(b);var c=e(b,'ic-global-indicator');if(c&&c!=="false"){d=a(c).first();}return d;}function aL(b){var d=a([]);b=a(b);if(c(b,'ic-indicator')){d=a(c(b,'ic-indicator')).first();}else{d=b.find(".ic-indicator").first();if(d.length==0){var f=e(b,'ic-indicator');if(f){d=a(f).first();}else{if(b.next().is('.ic-indicator')){d=b.next();}}}}return d;}function N(b,c){if(a.trim(c).indexOf("{")==0){var d=a.parseJSON(c);a.each(d,function(c,a){b=i(b,c,a);});}else{a(c).each(function(){var c=a(this).serializeArray();a.each(c,function(c,a){b=i(b,a.name,a.value);});});}return b;}function am(b,c){a(c.split(",")).each(function(){var c=a.trim(this);var d=localStorage.getItem(c);if(d){b=i(b,c,d);}});return b;}function i(c,d,b){if(a.type(c)==="string"){if(a.type(b)!=="string"){b=JSON.stringify(b);}return c+"&"+d+"="+encodeURIComponent(b);}else{c.append(d,b);return c;}}function aI(s,f,h){var j=p(f);var b=null;if(f.is('form')&&f.attr('enctype')=='multipart/form-data'){b=new FormData(f[0]);b=i(b,'ic-request',true);}else{b="ic-request=true";var r=f.closest('form');if(f.is('form')||(s!="GET"&&r.length>0)){b+="&"+r.serialize();var k=f.data('ic-last-clicked-button');if(k){b=i(b,k.name,k.value);}}else{b+="&"+f.serialize();}}var n=e(f,'ic-prompt');if(n){var m=prompt(n);if(m){var t=e(f,'ic-prompt-name')||'ic-prompt-value';b=i(b,t,m);}else{return null;}}if(f.attr('id')){b=i(b,'ic-element-id',f.attr('id'));}if(f.attr('name')){b=i(b,'ic-element-name',f.attr('name'));}if(c(j,'ic-id')){b=i(b,'ic-id',c(j,'ic-id'));}if(j.attr('id')){b=i(b,'ic-target-id',j.attr('id'));}if(h&&h.attr('id')){b=i(b,'ic-trigger-id',h.attr('id'));}if(h&&h.attr('name')){b=i(b,'ic-trigger-name',h.attr('name'));}var q=e(f,'ic-include');if(q){b=N(b,q);}var o=e(f,'ic-local-vars');if(o){b=am(b,o);}a(g('ic-global-include')).each(function(){b=N(b,c(a(this),'ic-global-include'));});b=i(b,'ic-current-url',I());var l=e(f,'ic-select-from-response');if(l){b=i(b,'ic-select-from-response',l);}d(f,"request parameters "+b,"DEBUG");return b;}function z(a){var b=p(a);X(b);if(a.data('elementAdded.ic')!=true){a.data('elementAdded.ic',true);h(a,"elementAdded.ic");}}function X(a){if(!c(a,'ic-id')){x(a,'ic-id',w());}return c(a,'ic-id');}function o(b){b=a(b);if(b.length>1){b.each(function(){o(this);});}else{al(b);ao(b);ah(b);ak(b);an(b);ag(b);aj(b);ap(b);ai(b);}}function u(b){h(b,'nodesProcessed.ic');a.each(aS,function(c,a){try{a(b);}catch(e){d(b,m(e),"ERROR");}});}function A(a){a.find('[autofocus]').last().focus();}function al(b){a.each(aV,function(d,c){if(b.closest('.ic-ignore').length==0){if(b.is('['+c+']')){M(c,b);}b.find('['+c+']').each(function(){var b=a(this);if(b.closest('.ic-ignore').length==0){M(c,b);}});}});}function ah(b){if(b.closest('.ic-ignore').length==0){if(b.is(g("ic-src"))){z(b);}b.find(g("ic-src")).each(function(){var b=a(this);if(b.closest('.ic-ignore').length==0){z(b);}});}}function ak(b){if(b.closest('.ic-ignore').length==0){if(b.is(g("ic-poll"))){z(b);s(b);}b.find(g("ic-poll")).each(function(){var b=a(this);if(b.closest('.ic-ignore').length==0){z(b);s(b);}});}}function ag(b){if(b.closest('.ic-ignore').length==0){R(b);b.find(g('ic-trigger-on')).each(function(){var b=a(this);if(b.closest('.ic-ignore').length==0){R(b);}});}}function aj(b){if(b.closest('.ic-ignore').length==0){T(b);b.find(g('ic-remove-after')).each(function(){var b=a(this);if(b.closest('.ic-ignore').length==0){T(b);}});}}function ap(b){if(b.closest('.ic-ignore').length==0){V(b);b.find(g('ic-add-class')).each(function(){var b=a(this);if(b.closest('.ic-ignore').length==0){V(b);}});}}function ai(b){if(b.closest('.ic-ignore').length==0){S(b);b.find(g('ic-remove-class')).each(function(){var b=a(this);if(b.closest('.ic-ignore').length==0){S(b);}});}}function ao(b){if(b.closest('.ic-ignore').length==0){if(e(b,'ic-enhance')==='true'){Z(b);}else{b.find(g('ic-enhance')).each(function(){Z(a(this));});}}}function an(b){if(b.closest('.ic-ignore').length==0){U(b);b.find(g('ic-sse-src')).each(function(){var b=a(this);if(b.closest('.ic-ignore').length==0){U(b);}});}}function s(b){if(b.data('ic-poll-interval-id')==null&&c(b,'ic-pause-polling')!='true'){var g=j(c(b,'ic-poll'));if(g!=null){var f=aD(b);var l=parseInt(c(b,'ic-poll-repeats'))||-1;var i=0;d(b,"POLL: Starting poll for element "+f,"DEBUG");var e=setInterval(function(){var c=a(f);h(b,"onPoll.ic",c);if((c.length==0)||(i==l)||b.data('ic-poll-interval-id')!=e){d(b,"POLL: Clearing poll for element "+f,"DEBUG");clearTimeout(e);}else{k(c);}i++;},g);b.data('ic-poll-interval-id',e);}}}function J(a){if(a.data('ic-poll-interval-id')!=null){clearTimeout(a.data('ic-poll-interval-id'));a.data('ic-poll-interval-id',null);}}function E(e,b){d(b,"refreshing dependencies for path "+e,"DEBUG");a(g('ic-src')).each(function(){var g=false;var f=a(this);if(B(f)=="GET"&&c(f,'ic-deps')!='ignore'){if(G(e,c(f,'ic-src'))){if(b==null||a(b)[0]!=f[0]){k(f);g=true;}}else if(az(e,c(f,'ic-deps'))||c(f,'ic-deps')=="*"){if(b==null||a(b)[0]!=f[0]){k(f);g=true;}}}if(g){d(f,"depends on path "+e+", refreshing...","DEBUG");}});}function az(e,c){if(c){var b=c.split(",");for(var a=0; a<b.length; a++){var d=b[a].trim();if(G(e,d)){return true;}}}return false;}function G(a,b){return!!aT(a,b);}function B(b){b=a(b);if(c(b,'ic-verb')){return c(b,'ic-verb').toUpperCase();}return"GET";}function aN(c,b){if(c=="default"){b=a(b);if(b.is('button')){return'click';}else if(b.is('form')){return'submit';}else if(b.is('input, textarea, select, button')){return'change';}else{return'click';}}else{return c;}}function aq(a,b){return a.is('form')||(a.is('input[type="submit"], button')&&a.closest('form').length==1)||(a.is('a')&&a.is('[href]')&&a.attr('href').indexOf('#')!=0);}function T(b){b=a(b);if(c(b,'ic-remove-after')){var d=j(c(b,'ic-remove-after'));setTimeout(function(){D(b);},d);}}function O(b,f,e){var a="";var d=50;if(b.indexOf(":")>0){var c=b.split(':');a=c[0];d=j(c[1]);}else{a=b;}setTimeout(function(){f[e](a);},d);}function V(b){b=a(b);if(c(b,'ic-add-class')){var e=c(b,'ic-add-class').split(",");var f=e.length;for(var d=0; d<f; d++){O(a.trim(e[d]),b,'addClass');}}}function S(b){b=a(b);if(c(b,'ic-remove-class')){var e=c(b,'ic-remove-class').split(",");var f=e.length;for(var d=0; d<f; d++){O(a.trim(e[d]),b,'removeClass');}}}function U(b){b=a(b);if(c(b,'ic-sse-src')){var d=c(b,'ic-sse-src');var e=aC(b,d);b.data('ic-event-sse-source',e);b.data('ic-event-sse-map',{});}}function aC(d,c){var a=b._internal.initEventSource(c);a.onmessage=function(a){y(a.data,d,false);};return a;}function ae(b,c){var d=b.data('ic-event-sse-source');var e=b.data('ic-event-sse-map');if(d.addEventListener&&e[c]!=true){d.addEventListener(c,function(){b.find(g('ic-trigger-on')).each(function(){var b=a(this);if(b.attr('ic-trigger-on')=="sse:"+c){k(b);}});});}}function H(d){var b=c(d,'ic-trigger-from');if(b){if(b=="document"){return a(document);}else if(b=="window"){return a(window);}else{return a(b);}}else{return d;}}function R(b){if(c(b,'ic-trigger-on')){if(b.is('form')){b.on('click focus','input, button, select, textarea',function(c){if(a(this).is('input[type="submit"], button')&&a(this).is("[name]")){b.data('ic-last-clicked-button',{name:a(this).attr("name"),value:a(this).val()});}else{b.data('ic-last-clicked-button',null);}});}if(c(b,'ic-trigger-on')=='load'){k(b);}else if(c(b,'ic-trigger-on')=='scrolled-into-view'){aB();setTimeout(function(){h(a(window),'scroll');},100);}else{var f=c(b,'ic-trigger-on').split(" ");if(f[0].indexOf("sse:")==0){var l=b.closest(g('ic-sse-src'));if(l.length>0){ae(l,f[0].substr(4));}}else{var f=c(a(b),'ic-trigger-on').split(" ");var i=aN(f[0],a(b));a(H(b)).on(i,function(a){var c=e(b,'ic-on-beforeTrigger');if(c){if(n(c,[["elt",b],["evt",a],["elt",b]])==false){d(b,"ic-trigger cancelled by ic-on-beforeTrigger","DEBUG");return false;}}if(f[1]=='changed'){var g=b.val();var h=b.data('ic-previous-val');b.data('ic-previous-val',g);if(g!=h){k(b);}}else if(f[1]=='once'){var i=b.data('ic-already-triggered');b.data('ic-already-triggered',true);if(i!==true){k(b);}}else{k(b);}if(aq(b,a)){a.preventDefault();return false;}return true;});if(i&&(i.indexOf("timeout:")==0)){setTimeout(function(){a(H(b)).trigger(i);},j(i.split(":")[1]));}}}}}function l(a,b){return a==q(b);}function M(b,a){if(l(b,'ic-post-to')){f(a,'ic-src',c(a,'ic-post-to'));f(a,'ic-verb','POST');f(a,'ic-trigger-on','default');f(a,'ic-deps','ignore');}if(l(b,'ic-put-to')){f(a,'ic-src',c(a,'ic-put-to'));f(a,'ic-verb','PUT');f(a,'ic-trigger-on','default');f(a,'ic-deps','ignore');}if(l(b,'ic-patch-to')){f(a,'ic-src',c(a,'ic-patch-to'));f(a,'ic-verb','PATCH');f(a,'ic-trigger-on','default');f(a,'ic-deps','ignore');}if(l(b,'ic-get-from')){f(a,'ic-src',c(a,'ic-get-from'));f(a,'ic-trigger-on','default');f(a,'ic-deps','ignore');}if(l(b,'ic-delete-from')){f(a,'ic-src',c(a,'ic-delete-from'));f(a,'ic-verb','DELETE');f(a,'ic-trigger-on','default');f(a,'ic-deps','ignore');}if(l(b,'ic-action')){f(a,'ic-trigger-on','default');}var d=null;var e=null;if(l(b,'ic-style-src')){d=c(a,'ic-style-src').split(":");var g=d[0];e=d[1];f(a,'ic-src',e);f(a,'ic-target','this.style.'+g);}if(l(b,'ic-attr-src')){d=c(a,'ic-attr-src').split(":");var h=d[0];e=d[1];f(a,'ic-src',e);f(a,'ic-target','this.'+h);}if(l(b,'ic-prepend-from')){f(a,'ic-src',c(a,'ic-prepend-from'));f(a,'ic-swap-style','prepend');}if(l(b,'ic-append-from')){f(a,'ic-src',c(a,'ic-append-from'));f(a,'ic-swap-style','append');}}function ax(a){return location.hostname===a[0].hostname&&a.attr('href')&&!a.attr('href').startsWith("#");}function _(a){if(e(a,'ic-enhance')==="true"){if(ax(a)){f(a,'ic-src',a.attr('href'));f(a,'ic-trigger-on','default');f(a,'ic-deps','ignore');f(a,'ic-push-url','true');}}}function aO(a){return a.find('input[name="_method"]').val()||a.attr('method')||a[0].method;}function Y(a){if(e(a,'ic-enhance')==="true"){f(a,'ic-src',a.attr('action'));f(a,'ic-trigger-on','default');f(a,'ic-deps','ignore');f(a,'ic-verb',aO(a));}}function Z(b){if(b.is('a')){_(b);}b.find('a').each(function(){_(a(this));});if(b.is('form')){Y(b);}b.find('form').each(function(){Y(a(this));});}function f(a,b,d){if(c(a,b)==null){x(a,b,d);}}function aw(b){b=a(b);if(b.height()==0&&b.width()==0){return false;}var d=a(window).scrollTop();var f=d+a(window).height();var c=b.offset().top;var e=c+b.height();return((e>=d)&&(c<=f)&&(e<=f)&&(c>=d));}function at(d,b){if(e(d,'ic-scroll-to-target')!="false"&&(e(d,'ic-scroll-to-target')=='true'||e(b,'ic-scroll-to-target')=='true')){var c=-50;if(e(d,'ic-scroll-offset')){c=parseInt(e(d,'ic-scroll-offset'));}else if(e(b,'ic-scroll-offset')){c=parseInt(e(b,'ic-scroll-offset'));}var f=b.offset().top;var g=a(window).scrollTop();var h=g+window.innerHeight;if(f<g||f>h){c+=f;a('html,body').animate({scrollTop:c},400);}}}function aF(h,c){var b=e(h,'ic-transition-duration');if(b){return j(b);}b=e(c,'ic-transition-duration');if(b){return j(b);}c=a(c);var d=0;var f=c.css('transition-duration');if(f){d+=j(f);}var g=c.css('transition-delay');if(g){d+=j(g);}return d;}function ab(b){var a=b.data('ic-event-sse-source');try{if(a){a.close();}}catch(c){d(b,"Error closing ServerSentEvent source"+c,"ERROR");}}function ac(b){b.find(g('ic-sse-src')).each(function(){ab(a(this));});h(b,'beforeSwap.ic');}function y(j,f,s,l){if(j&&j!=""&&j!=" "){d(f,"response content: \n"+j,"DEBUG");var b=p(f);var k=e(f,'ic-transform-response');if(k){j=n(k,[["content",j],["url",l],["elt",f]]);}var i=au(j,e(f,'ic-select-from-response'));if(e(f,'ic-fix-ids')=="true"){aK(i);}var t=function(){if(e(f,'ic-replace-target')=="true"){try{ac(b);ab(b);b.replaceWith(i);b=i;}catch(k){d(f,m(k),"ERROR");}o(i);u(b);A(b);}else{if(c(f,'ic-swap-style')=="prepend"){ar(b,i);o(i);u(b);A(b);}else if(c(f,'ic-swap-style')=="append"){aR(b,i);o(i);u(b);A(b);}else{try{ac(b);b.empty().append(i);}catch(k){d(f,m(k),"ERROR");}b.children().each(function(){o(this);});u(b);A(b);}if(s!=true){at(f,b);}var h=f.closest(g('ic-switch-class'));var j=h.attr(q('ic-switch-class'));if(j){h.children().removeClass(j);h.children().each(function(){console.log(a(this));if(a.contains(a(this)[0],a(f)[0])||a(this)[0]==a(f)[0]){a(this).addClass(j);}});}}};if(b.length==0){d(f,"Invalid target for element: "+c(f.closest(g('ic-target')),'ic-target'),"ERROR");return;}var v=aF(f,b);b.addClass('ic-transitioning');setTimeout(function(){try{t();}catch(a){d(f,"Error during content swap : "+m(a),"ERROR");}setTimeout(function(){try{b.removeClass('ic-transitioning');if(r){r.updateHistory();}h(b,"complete_transition.ic",[b]);}catch(a){d(f,"Error during transition complete : "+m(a),"ERROR");}},20);},v);}else{d(f,"Empty response, nothing to do here.","DEBUG");}}function au(c,d){var b;if(a.zepto){var e=aa(c);b=a(e).find('body').contents();}else{b=a(a.parseHTML(c,null,true));}if(d){return v(b,d).contents();}else{return b;}}function v(b,a){return b.filter(a).add(b.find(a));}function aK(c){var b={};v(c,"[id]").each(function(){var d=a(this).attr("id");var c;do{c="ic-fixed-id-"+w();}while(a("#"+c).length>0);b[d]=c;a(this).attr("id",c);});v(c,"label[for]").each(function(){var c=a(this).attr("for");a(this).attr("for",b[c]||c);});v(c,"*").each(function(){a.each(this.attributes,function(){if(this.value.indexOf("#")!==-1){this.value=this.value.replace(/#([-_A-Za-z0-9]+)/g,function(c,a){return"#"+(b[a]||a);});}});});}function aG(b){var a=e(b,'ic-target');if(a&&a.indexOf("this.style.")==0){return a.substr(11);}else{return null;}}function aJ(b){var a=e(b,'ic-target');if(a&&a.indexOf("this.")==0){return a.substr(5);}else{return null;}}function k(b,m){b=a(b);var l=b;if(!b.is(g('ic-src'))&&c(b,'ic-action')==undefined){b=b.closest(g('ic-src'));}var i=e(b,'ic-confirm');if(i){if(!confirm(i)){return;}}if("true"==e(b,'ic-disable-when-doc-hidden')){if(document['hidden']){return;}}if("true"==e(b,'ic-disable-when-doc-inactive')){if(!document.hasFocus()){return;}}if(b.length>0){var h=w();b.data('ic-event-id',h);var d=function(){if(b.data('ic-request-in-flight')==true){b.data('ic-next-request',{"req":d});return;}if(b.data('ic-event-id')==h){var f=aG(b);var i=f?null:aJ(b);var a=B(b);var e=c(b,'ic-src');if(e){var j=m||function(d){if(f){b.css(f,d);}else if(i){b.attr(i,d);}else{y(d,b,false,e);if(a!='GET'){E(c(b,'ic-src'),b);}}};var g=aI(a,b,l);if(g){aE(b,a,e,g,j);}}t(b,"");}};var f=e(b,'ic-trigger-delay');if(f){setTimeout(d,j(f));}else{d();}}}function t(b,a){var d=c(b,'ic'+a+'-action');if(d){aA(b,d,a);}}function aA(c,i,g){var f=e(c,'ic'+g+'-action-target');if(f===null&&g!==""){f=e(c,'ic-action-target');}var d=null;if(f){d=W(c,'ic-action-target');}else{d=p(c);}var k=i.split(";");var h=[];var b=0;a.each(k,function(i,g){var c=a.trim(g);var e=c;var f=[];if(c.indexOf(":")>0){e=c.substr(0,c.indexOf(":"));f=aP(c.substr(c.indexOf(":")+1,c.length));}if(e==""){}else if(e=="delay"){if(b==null){b=0;}b+=j(f[0]+"");}else{if(b==null){b=420;}h.push([b,av(d,e,f)]);b=null;}});b=0;a.each(h,function(c,a){b+=a[0];setTimeout(a[1],b);});}function aP(b){try{return eval("["+b+"]");}catch(c){return[a.trim(b)];}}function av(a,b,c){return function(){var e=a[b]||window[b];if(e){e.apply(a,c);}else{d(a,"Action "+b+" was not found","ERROR");}};}function as(b,w,i,m){var o='ic-history-support';var p="ic-hist-elt-";var e=JSON.parse(b.getItem(o));var f=null;if(v(e)){d(c(a('body')),"Intercooler History configuration changed, clearing history","INFO");j();}if(e==null){e={slotLimit:i,historyVersion:m,lruList:[]};}function v(a){return a==null||a.slotLimit!=i||a.historyVersion!=m||a.lruList==null;}function j(){var c=[];for(var a=0; a<b.length; a++){if(b.key(a).indexOf(p)==0){c.push(b.key(a));}}for(var d=0; d<c.length; d++){b.removeItem(c[d]);}b.removeItem(o);e={slotLimit:i,historyVersion:m,lruList:[]};}function k(g){var f=e.lruList;var j=f.indexOf(g);var h=c(a('body'));if(j>=0){d(h,"URL found in LRU list, moving to end","INFO");f.splice(j,1);f.push(g);}else{d(h,"URL not found in LRU list, adding","INFO");f.push(g);if(f.length>e.slotLimit){var i=f.shift();d(h,"History overflow, removing local history for "+i,"INFO");b.removeItem(p+i);}}b.setItem(o,JSON.stringify(e));return f;}function t(e){var f=JSON.stringify(e);try{b.setItem(e.id,f);}catch(g){try{j();b.setItem(e.id,f);}catch(g){d(c(a('body')),"Unable to save intercooler history with entire history cleared, is something else eating "+"local storage? History Limit:"+i,"ERROR");}}}function l(e,c,a,d){var b={"url":a,"id":p+a,"content":e,"yOffset":c,"timestamp":new Date().getTime(),"title":d};k(a);t(b);return b;}function n(b){if(b.onpopstate==null||b.onpopstate['ic-on-pop-state-handler']!=true){var d=b.onpopstate;b.onpopstate=function(b){h(c(a('body')),'handle.onpopstate.ic');if(!x(b)){if(d){d(b);}}h(c(a('body')),'pageLoad.ic');};b.onpopstate['ic-on-pop-state-handler']=true;}}function q(){if(f){u(f.newUrl,I(),f.oldHtml,f.yOffset,f.oldTitle);f=null;}}function u(e,g,j,f,i){var k=l(j,f,g,i);w.replaceState({"ic-id":k.id},"","");var b=c(a('body'));var d=l(b.html(),window.pageYOffset,e,document.title);w.pushState({'ic-id':d.id},"",e);h(b,"pushUrl.ic",[b,d]);}function x(f){var e=f.state;if(e&&e['ic-id']){var d=JSON.parse(b.getItem(e['ic-id']));if(d){y(d["content"],c(a('body')),true);if(d["yOffset"]){window.scrollTo(0,d["yOffset"]);}if(d["title"]){document.title=d["title"];}return true;}else{a.get(I(),{'ic-restore-history':true},function(e,f){var d=aa(e);var b=c(d).html();y(b,c(a('body')),true);});}}return false;}function c(b){var a=b.find(g('ic-history-elt'));if(a.length>0){return a;}else{return b;}}function s(e,d){var b=c(a('body'));h(b,"beforeHistorySnapshot.ic",[b]);f={newUrl:e,oldHtml:b.html(),yOffset:window.pageYOffset,oldTitle:d};}function z(){var d="";var a=[];for(var g in b){a.push(g);}a.sort();var c=0;for(var f in a){var e=(b[a[f]].length*2);c+=e;d+=a[f]+"="+(e/1024/1024).toFixed(2)+" MB\n";}return d+"\nTOTAL LOCAL STORAGE: "+(c/1024/1024).toFixed(2)+" MB";}function r(){return e;}return{clearHistory:j,updateHistory:q,addPopStateHandler:n,snapshotForHistory:s,_internal:{addPopStateHandler:n,supportData:r,dumpLocalStorage:z,updateLRUList:k}};}function aH(){return 20;}function af(a){if(typeof a=='string'||a instanceof String){E(a);}else{k(a);}return b;}var r=null;try{r=as(localStorage,window.history,aH(),.1);}catch(aY){d(a('body'),"Could not initialize history","WARN");}if(a.ajaxTransport){a.ajaxTransport("text",function(i,g){if(g.url[0]=="#"){var e=q("ic-local-");var d=a(g.url);var f=[];var c=200;var b="OK";d.each(function(g,d){a.each(d.attributes,function(h,a){if(a.name.substr(0,e.length)==e){var g=a.name.substring(e.length);if(g=="status"){var d=a.value.match(/(\d+)\s?(.*)/);if(d!=null){c=d[1];b=d[2];}else{c="500";b="Attribute Error";}}else{f.push(g+": "+a.value);}}});});var h=d.length>0?d.html():"";return{send:function(d,a){a(c,b,{html:h},f.join("\n"));},abort:function(){}};}else{return null;}});}function P(){var b=a('body');o(b);u(b);if(r){r.addPopStateHandler(window);}if(a.zepto){a('body').data('zeptoDataTest',{});if(typeof(a('body').data('zeptoDataTest'))=="string"){console.log("!!!! Please include the data module with Zepto!  Intercooler requires full data support to function !!!!");}}}a(function(){P();});return{refresh:af,history:r,triggerRequest:k,processNodes:o,closestAttrValue:e,verbFor:B,isDependent:G,getTarget:p,processHeaders:F,startPolling:s,cancelPolling:J,setIsDependentFunction:function(a){aT=a;},ready:function(a){aS.push(a);},_internal:{init:P,replaceOrAddMethod:L,initEventSource:function(a){return new EventSource(a);},globalEval:n}};})();return b;}));